<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ruleta Configuración - LQISTUDIO</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- LOGIN -->
<div id="login">
  <div class="login-container">
    <h1>Bienvenido al Salón de Pruebas de LQISTUDIO</h1>
    <input type="text" id="username" placeholder="Usuario">
    <input type="password" id="password" placeholder="Contraseña">
    <button id="loginBtn">Entrar</button>
    <p id="loginMsg"></p>
  </div>
</div>

<!-- PANEL -->
<div id="panel" style="display:none;">
  <!-- Botón de logout visible y destacado -->
  <button id="logoutBtn" class="logout" style="position:absolute; top:20px; right:20px;">Cerrar sesión</button>

  <div id="controls">
    <h2>Configurar ruleta</h2>
    <div id="options"></div>
    <button id="addOption">➕ Agregar opción</button>

    <div id="settings">
      <label>
        🎨 Color de fondo:
        <input type="color" id="bgColor" value="#000000">
        <input type="checkbox" id="transparentBg"> Transparente
      </label>

      <label>
        <input type="checkbox" id="solidColors" checked>
        Usar colores en los sectores
      </label>
    </div>
  </div>

  <canvas id="wheel" width="400" height="400"></canvas>
  <button id="spin">🎯 Girar</button>
  <div id="result"></div>

  <p style="margin-top:20px;font-size:14px;color:#aaa;">
    🔗 Tu overlay listo para OBS:  
    <button id="openOverlay">Abrir Overlay</button>
  </p>
</div>

<script src="app.js"></script>

<script>
  // --- LOGIN y LOGOUT ---
  const loginDiv = document.getElementById("login");
  const panelDiv = document.getElementById("panel");
  const loginBtn = document.getElementById("loginBtn");
  const loginMsg = document.getElementById("loginMsg");
  const logoutBtn = document.getElementById("logoutBtn");

  const USER = "admin";
  const PASS = "1234";

  // Overlay
  let overlayWindow = null;

  // Si ya estaba logueado
  if(localStorage.getItem("loggedIn") === "true"){
    loginDiv.style.display = "none";
    panelDiv.style.display = "block";
  }

  loginBtn.addEventListener("click", ()=>{
    const u = document.getElementById("username").value;
    const p = document.getElementById("password").value;
    if(u === USER && p === PASS){
      localStorage.setItem("loggedIn","true");
      loginDiv.style.display = "none";
      panelDiv.style.display = "block";
    } else {
      loginMsg.textContent = "❌ Usuario o contraseña incorrectos";
    }
  });

  // Logout
  logoutBtn.addEventListener("click", ()=>{
    localStorage.removeItem("loggedIn");
    panelDiv.style.display = "none";
    loginDiv.style.display = "flex";
    if(overlayWindow && !overlayWindow.closed) overlayWindow.close();
  });

  // Abrir overlay
  const openOverlayBtn = document.getElementById("openOverlay");
  openOverlayBtn.addEventListener("click", ()=>{
    if(!overlayWindow || overlayWindow.closed){
      overlayWindow = window.open("overlay.html", "Overlay", "width=420,height=440");
    } else {
      overlayWindow.focus();
    }
  });

  // --- Enviar spin y actualización de opciones al overlay ---
  const spinBtn = document.getElementById("spin");

  function sendUpdateToOverlay(){
    if(overlayWindow && !overlayWindow.closed){
      const options = JSON.parse(localStorage.getItem("wheelOptions")) || [];
      const settings = JSON.parse(localStorage.getItem("wheelSettings")) || {};
      overlayWindow.postMessage({action:"update", options, settings}, "*");
    }
  }

  spinBtn.addEventListener("click", ()=>{
    // Actualizar overlay antes de girar
    sendUpdateToOverlay();
    if(overlayWindow && !overlayWindow.closed){
      overlayWindow.postMessage({action:"spin"}, "*");
    }
  });

  // Enviar actualización al overlay cada vez que se modifiquen opciones o settings
  document.getElementById("addOption").addEventListener("click", sendUpdateToOverlay);
  document.getElementById("bgColor").addEventListener("change", sendUpdateToOverlay);
  document.getElementById("transparentBg").addEventListener("change", sendUpdateToOverlay);
  document.getElementById("solidColors").addEventListener("change", sendUpdateToOverlay);
</script>

</body>
</html>
